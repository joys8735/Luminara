/**\n * usePoints Hook\n * React hook for accessing and managing points data\n * \n * Validates: Requirements 10.5, 10.6\n */\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { PointsData, PointsType, Transaction } from '../types';\nimport { pointsAPI } from '../services/PointsAPI';\nimport { eventSystem } from '../services/EventSystem';\nimport { storageManager } from '../services/StorageManager';\nimport { STORAGE_KEYS } from '../constants';\n\ninterface UsePointsReturn {\n  points: PointsData | null;\n  loading: boolean;\n  error: string | null;\n  addPoints: (amount: number, pointsType: PointsType, reason: string) => Promise<boolean>;\n  subtractPoints: (amount: number, pointsType: PointsType, reason: string) => Promise<boolean>;\n  transferPoints: (toUserId: string, amount: number, pointsType: PointsType, reason: string) => Promise<boolean>;\n  getBalance: (pointsType: PointsType) => number;\n  refresh: () => Promise<void>;\n}\n\nexport function usePoints(userId?: string): UsePointsReturn {\n  const [points, setPoints] = useState<PointsData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentUserId, setCurrentUserId] = useState<string | null>(userId || null);\n\n  // Load points data\n  const loadPoints = useCallback(async () => {\n    if (!currentUserId) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const data = await pointsAPI.getPoints(currentUserId);\n      if (data) {\n        setPoints(data);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load points');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentUserId]);\n\n  // Subscribe to points changes\n  useEffect(() => {\n    if (!currentUserId) return;\n\n    loadPoints();\n\n    // Subscribe to points-changed events\n    const unsubscribe = eventSystem.on('points-changed', (event) => {\n      if (event.userId === currentUserId) {\n        setPoints((prev) => {\n          if (!prev) return prev;\n          return {\n            ...prev,\n            [event.transaction.pointsType]: event.newBalance,\n            lastUpdated: event.transaction.timestamp,\n          };\n        });\n      }\n    });\n\n    // Requirement 10.6: Cleanup on unmount to prevent memory leaks\n    return () => {\n      unsubscribe();\n    };\n  }, [currentUserId, loadPoints]);\n\n  // Add points\n  const handleAddPoints = useCallback(\n    async (amount: number, pointsType: PointsType, reason: string): Promise<boolean> => {\n      if (!currentUserId) {\n        setError('User ID not set');\n        return false;\n      }\n\n      try {\n        const result = await pointsAPI.addPoints(currentUserId, amount, pointsType, reason);\n        if (!result.success) {\n          setError(result.error || 'Failed to add points');\n          return false;\n        }\n        return true;\n      } catch (err) {\n        const errorMsg = err instanceof Error ? err.message : 'Failed to add points';\n        setError(errorMsg);\n        return false;\n      }\n    },\n    [currentUserId]\n  );\n\n  // Subtract points\n  const handleSubtractPoints = useCallback(\n    async (amount: number, pointsType: PointsType, reason: string): Promise<boolean> => {\n      if (!currentUserId) {\n        setError('User ID not set');\n        return false;\n      }\n\n      try {\n        const result = await pointsAPI.subtractPoints(currentUserId, amount, pointsType, reason);\n        if (!result.success) {\n          setError(result.error || 'Failed to subtract points');\n          return false;\n        }\n        return true;\n      } catch (err) {\n        const errorMsg = err instanceof Error ? err.message : 'Failed to subtract points';\n        setError(errorMsg);\n        return false;\n      }\n    },\n    [currentUserId]\n  );\n\n  // Transfer points\n  const handleTransferPoints = useCallback(\n    async (toUserId: string, amount: number, pointsType: PointsType, reason: string): Promise<boolean> => {\n      if (!currentUserId) {\n        setError('User ID not set');\n        return false;\n      }\n\n      try {\n        const result = await pointsAPI.transferPoints(currentUserId, toUserId, amount, pointsType, reason);\n        if (!result.success) {\n          setError(result.error || 'Failed to transfer points');\n          return false;\n        }\n        return true;\n      } catch (err) {\n        const errorMsg = err instanceof Error ? err.message : 'Failed to transfer points';\n        setError(errorMsg);\n        return false;\n      }\n    },\n    [currentUserId]\n  );\n\n  // Get balance for specific type\n  const getBalance = useCallback(\n    (pointsType: PointsType): number => {\n      if (!points) return 0;\n      return points[pointsType as keyof PointsData] as number;\n    },\n    [points]\n  );\n\n  // Refresh points\n  const refresh = useCallback(async () => {\n    await loadPoints();\n  }, [loadPoints]);\n\n  return {\n    points,\n    loading,\n    error,\n    addPoints: handleAddPoints,\n    subtractPoints: handleSubtractPoints,\n    transferPoints: handleTransferPoints,\n    getBalance,\n    refresh,\n  };\n}\n