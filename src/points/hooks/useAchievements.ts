/**\n * useAchievements Hook\n * React hook for tracking achievements\n * \n * Validates: Requirements 4.1, 4.2, 4.3\n */\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { Achievement, UserAchievement } from '../types';\nimport { achievementManager } from '../services/AchievementManager';\nimport { eventSystem } from '../services/EventSystem';\n\ninterface UseAchievementsReturn {\n  achievements: Achievement[];\n  userAchievements: UserAchievement[];\n  loading: boolean;\n  error: string | null;\n  hasAchievement: (achievementId: string) => boolean;\n  getProgress: (totalPoints: number) => {\n    unlockedCount: number;\n    totalCount: number;\n    nextAchievement: Achievement | null;\n    nextThreshold: number;\n  };\n}\n\nexport function useAchievements(userId?: string): UseAchievementsReturn {\n  const [achievements, setAchievements] = useState<Achievement[]>([]);\n  const [userAchievements, setUserAchievements] = useState<UserAchievement[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentUserId, setCurrentUserId] = useState<string | null>(userId || null);\n\n  // Load achievements\n  const loadAchievements = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Get all achievements\n      const allAchievements = achievementManager.getAchievements();\n      setAchievements(allAchievements);\n\n      // Get user achievements\n      if (currentUserId) {\n        const userAchs = achievementManager.getUserAchievements(currentUserId);\n        setUserAchievements(userAchs);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load achievements');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentUserId]);\n\n  // Subscribe to achievement unlocks\n  useEffect(() => {\n    loadAchievements();\n\n    // Subscribe to achievement-unlocked events\n    const unsubscribe = eventSystem.on('achievement-unlocked', (event) => {\n      if (event.userId === currentUserId) {\n        // Reload user achievements\n        const userAchs = achievementManager.getUserAchievements(currentUserId!);\n        setUserAchievements(userAchs);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [currentUserId, loadAchievements]);\n\n  // Check if user has achievement\n  const hasAchievement = useCallback(\n    (achievementId: string): boolean => {\n      if (!currentUserId) return false;\n      return achievementManager.hasAchievement(currentUserId, achievementId);\n    },\n    [currentUserId]\n  );\n\n  // Get progress\n  const getProgress = useCallback(\n    (totalPoints: number) => {\n      if (!currentUserId) {\n        return {\n          unlockedCount: 0,\n          totalCount: achievements.length,\n          nextAchievement: null,\n          nextThreshold: 0,\n        };\n      }\n\n      return achievementManager.getProgress(currentUserId, totalPoints);\n    },\n    [currentUserId, achievements.length]\n  );\n\n  return {\n    achievements,\n    userAchievements,\n    loading,\n    error,\n    hasAchievement,\n    getProgress,\n  };\n}\n